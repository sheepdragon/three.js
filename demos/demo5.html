<!DOCTYPE html>
<html lang="en">
	<head>
		<title>demo</title>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
		/>
		<link type="text/css" rel="stylesheet" href="/examples/main.css" />
		<style>
			a {
				color: blue;
			}
			.control-inactive button {
				color: #888;
			}
		</style>
	</head>
	<body>
		<div id="container"></div>
		<!-- Import maps polyfill -->
		<!-- Remove this when import maps will be widely supported -->
		<script
			async
			src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"
		></script>

		<script type="importmap">
			{
				"imports": {
					"three": "../build/three.module.js",
					"three/addons/": "/examples/jsm/"
				}
			}
		</script>

		<script type="module">
			import * as THREE from "three";

			import Stats from "three/addons/libs/stats.module.js";
			import { GUI } from "three/addons/libs/lil-gui.module.min.js";
			import { OrbitControls } from "three/addons/controls/OrbitControls.js";
			import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";

			let scene, renderer, camera, stats, clock;
			let controls, mesh;

			const twoPi = Math.PI * 2;
			const aspect = window.innerWidth / window.innerHeight;

			init();
			animate();

			function init() {
				clock = new THREE.Clock();
				const container = document.getElementById("container");

				stats = new Stats();
				container.appendChild(stats.dom);

				// renderer
				renderer = new THREE.WebGLRenderer({ antialias: true });
				renderer.setPixelRatio(window.devicePixelRatio);
				renderer.setSize(window.innerWidth, window.innerHeight);
				renderer.shadowMap.enabled = true;
				container.appendChild(renderer.domElement);

				scene = new THREE.Scene();
				scene.background = new THREE.Color(0x444444);
				// scene.fog = new THREE.Fog(0xa0a0a0, 10, 50);
				scene.add(new THREE.AxesHelper(30));

				// camera
				camera = new THREE.PerspectiveCamera(40, aspect, 1, 1000);
				camera.position.set(15, 17, 40);
				window.camera = camera;

				// controls
				controls = new OrbitControls(camera, renderer.domElement);
				controls.target.set(0, 1, 0);
				controls.update();
				controls.enablePan = true;
				controls.enableZoom = true;
				controls.enableDamping = true;

				// 光源
				const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444);
				hemiLight.position.set(0, 50, 0);
				scene.add(hemiLight);
				scene.add(new THREE.HemisphereLightHelper(hemiLight, 5));

				const light = new THREE.SpotLight(0xffffff, 1.5);
				light.position.set(50, 50, -10);
				light.angle = Math.PI * 0.2;
				light.castShadow = true;
				// scene.add(light);

				// 验证glb模型
				const textureLoader = new THREE.TextureLoader();
				const loader = new GLTFLoader();
				loader.load(
					"./untitled1.glb",
					function (gltf) {
						console.log(gltf);
						scene.add(gltf.scene);
						gltf.scene.scale.set(5, 5, 5);
						gltf.scene.children[0].material.map = textureLoader.load(
							// "./head.jpg",
							'./texture-atlas.jpg',
							// "./uv_grid_directx.jpg"
						);
					},
					function (xhr) {
						console.log((xhr.loaded / xhr.total) * 100 + "% loaded");
					},
					function (error) {
						console.log("An error happened");
					}
				);

				window.scene = scene;
			}

			window.onresize = function onWindowResize() {
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize(window.innerWidth, window.innerHeight);
			};

			function animate() {
				requestAnimationFrame(animate);

				controls.update();
				stats.update();
				renderer.render(scene, camera);
			}
		</script>
	</body>
</html>
